# applaudgen

`applaudgen` parses [App Store Connect specification file](https://developer.apple.com/sample-code/app-store-connect/app-store-connect-openapi-specification.zip) and generates client library for accessing [App Store Connect API](https://developer.apple.com/documentation/appstoreconnectapi).

## Prerequisites

This project is written in Python, and uses [Poetry](https://python-poetry.org/) for packaging and dependency management. You should have [Poetry installed](https://python-poetry.org/docs/#installation) if you want to contribute to the Python code in this repository.


## Usage

The `applaudgen` command:
```bash
usage: applaudgen.py [-h] [-s SPEC_FILE] [-o OUTPUT_DIR]

Generate Python SDK code for the App Store Connect API.

optional arguments:
  -h, --help            show this help message and exit
  -s SPEC_FILE, --spec SPEC_FILE
                        Path to the App Store Connect API specification file.
  -o OUTPUT_DIR, --output OUTPUT_DIR
                        Path to the package output directory.
```

`SPEC_FILE` defaults to `app_store_connect_api.json` under project root, which is the latest supported version (1.6 at present) of App Store Connect specification file.

`OUTPUT_DIR` defaults to `./PythonPackage`.

## Compare to other OpenAPI client generators

Code generated by most OpenAPI client generators are not as elegant as by `applaudgen`.

For example, App Store Connect API has tons of inner schemas like [`UserUpdateRequest.Data.Attributes`](https://developer.apple.com/documentation/appstoreconnectapi/userupdaterequest/data/attributes) and [`AppInfoLocalizationCreateRequest.Data.Relationships.AppInfo.Data`](https://developer.apple.com/documentation/appstoreconnectapi/appinfolocalizationcreaterequest/data/relationships/appinfo/data). [datamodel-code-generator](https://github.com/koxudaxi/datamodel-code-generator) creates numerous schema classes `Data1`, `Data2` … for each inner `Data` schema.

On the contrary, `applaudgen` creates inner classes to align with App Store Connect API documentation perfectly:
```python
class UserUpdateRequest(ApplaudModel):
    class Data(ApplaudModel):
        class Attributes(ApplaudModel):
            roles: Optional[list[UserRole]]
            all_apps_visible: Optional[bool]
            provisioning_allowed: Optional[bool]

        class Relationships(ApplaudModel):
            class VisibleApps(ApplaudModel):
                class Data(ApplaudModel):
                    id: str
                    type: Literal["apps"] = "apps"

                data: Optional[list[Data]]

            visible_apps: Optional[VisibleApps]

        id: str
        type: Literal["users"] = "users"
        attributes: Optional[Attributes]
        relationships: Optional[Relationships]

    data: Data
```

A common pitfall of generic OpenAPI client generators is rigid, inflexible. Take an example, [`ErrorResponse`](https://developer.apple.com/documentation/appstoreconnectapi/errorresponse) is a schema of course, `applaudgen` wraps it into an exception for you without write extra code:

```python
connection = ApplaudConnection(APPSTORE_ISSUER_ID, APPSTORE_KEY_ID, APPSTORE_PRIVATE_KEY)

try:
    response = connection.beta_tester_invitation_list().create(…)
except EndpointException as err:
    already_accepted_error = False
    for e in err.errors:
        if e.code == 'STATE_ERROR.TESTER_INVITE.ALREADY_ACCEPTED':
            # silent this error
            already_accepted_error = True
            break

    if not already_accepted_error:
        raise err
```

You always get a correct response on success, or an exception otherwise.


Further more, `applaudgen` provides full function yet simple interfaces to perform tasks on App Store Connect:
```python
connection = ApplaudConnection(APPSTORE_ISSUER_ID, APPSTORE_KEY_ID, APPSTORE_PRIVATE_KEY)
response = connection.beta_group_list().filter(app=[app_id1, app_id2], name="Example Tester Group", is_internal_group=False).include(BetaGroupListEndpoint.Include.APP).get()

for group in beta_groups.data:
    print(group.id, group.attributes.created_date, group.relationships.app.data.id)
```

Above code lists all **external** beta groups that named `Example Tester Group` in apps with `id`s `app_id1` and `app_id2`, and the response **includes** related corresponding id of the owner app.

## TODO

- [ ] Generates Swift client library
- [ ] Python syntactic sugar to simplify the initialization of deep inner classes
